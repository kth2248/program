from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

news_category = ['연예', '날씨', '정치', '과학']
scraped_news = {}
kor_news_company = "조선일보"
news_company_url = 'www.chosun.com'

driver = webdriver.Chrome()
for category in news_category:
    google_url = f"https://www.google.com/search?q={category}+{kor_news_company}&tbm=nws"        #category를 검색한 구글 뉴스 앱 url
    driver.get(google_url)  # 해당 url로 이동
    # 나온 뉴스 기사들 중 위에 아래로 하나씩 훑어본다. 그 다음 조선일보 기사라면 그 기사 페이지로 이동한다.
    # div태그 내에서 class가 SoaBEf인 태그들 가져오기
    WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.CSS_SELECTOR, '#rso > div > div > div:nth-child(1)')))
    div_tags = driver.find_elements(By.CSS_SELECTOR, '#rso > div > div > div:nth-child(1)')
    for news in div_tags:
        a_tag = news.find_element(By.TAG_NAME, 'a')
        news_url = a_tag.get_attribute('href')
        if news_company_url in news_url:
            print(news_url)
            driver.get(news_url)
            break

    WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.TAG_NAME, "title")))
    news_title = driver.title
    selector = "#fusion-app > div.article.\| > div:nth-child(2) > div > section > article > section"
    news_content = driver.find_element(By.CSS_SELECTOR, selector)
    scraped_news[news_title] = news_content.text


driver.quit()
print(scraped_news)


from dotenv import load_dotenv
import os
load_dotenv()
APIKEY = os.getenv("APIKEY")

from google import genai

client = genai.Client(api_key = APIKEY)
for title, content in scraped_news.items():
    response = client.models.generate_content(
        model='gemini-2.5-flash', contents=f"너가 기자라고 생각하고 내가 보낸 기사내용을 읽고 동일한 주제로 기사를 작성해봐\n제목:{title}\n내용:{content}"
    )
    print(response.text)
client.close()
